<UserControl
  x:Class="HEC.FDA.View.LifeLoss.IndexPointsLifeLoss"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:local="clr-namespace:HEC.FDA.View.LifeLoss"
  xmlns:Utilities="clr-namespace:HEC.FDA.View.Utilities"
  xmlns:UserControls="clr-namespace:UserControls.UserControls;assembly=HEC.FDA.UserControls"
  xmlns:frameworkControls="clr-namespace:HEC.MVVMFramework.View.UserControls;assembly=HEC.MVVMFramework.View"
  xmlns:oxy="http://oxyplot.org/wpf"
  xmlns:lifeloss="clr-namespace:HEC.FDA.ViewModel.LifeLoss;assembly=HEC.FDA.ViewModel"
  xmlns:compute="clr-namespace:HEC.FDA.View.Compute"
  mc:Ignorable="d"
  d:DesignHeight="450"
  d:DesignWidth="800"
  d:DataContext="{d:DesignInstance Type=lifeloss:IndexPointsLifeLossVM}">
  <UserControl.Resources>
    <Utilities:MilitaryTimeConverter
      x:Key="MilTimeConverter" />
    <Utilities:BoolToVisibilityConverter
      x:Key="BoolToVisibilityConverter" />
  </UserControl.Resources>
  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition
        Height="auto" />
      <RowDefinition
        Height="5" />
      <RowDefinition
        Height="*" />
    </Grid.RowDefinitions>
    <GroupBox
      Header="Configure and Compute"
      Grid.Row="0"
      Margin="5">
      <Grid
        Grid.Row="0">
        <Grid.RowDefinitions>
          <RowDefinition
            Height="auto" />
          <RowDefinition
            Height="auto" />
        </Grid.RowDefinitions>
        <Grid
          Grid.Row="0">
          <Grid.ColumnDefinitions>
            <ColumnDefinition
              Width="120" />
            <ColumnDefinition
              Width="1*" />
          </Grid.ColumnDefinitions>

          <TextBlock
            Text="LifeSim Database:"
            Grid.Row="0"
            Grid.Column="0"
            HorizontalAlignment="Right"
            VerticalAlignment="Center"
            Margin="0,0,5,0" />
          <frameworkControls:TextBoxFileBrowserControl
            FileDialogTitle="Select File"
            Filter="*.fia |*.fia"
            Path="{Binding SelectedPath}"
            Grid.Row="0"
            Grid.Column="1"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch"
            Margin="0,0,3,0" />
        </Grid>
        <Grid
          Grid.Row="1">
          <Grid.ColumnDefinitions>
            <ColumnDefinition
              Width="Auto" />
            <ColumnDefinition
              Width="*" />
          </Grid.ColumnDefinitions>

          <!-- Left side: Comboboxes stacked vertically -->
          <Grid
            Grid.Column="0"
            Margin="0,0,30,0">
            <Grid.RowDefinitions>
              <RowDefinition
                Height="35" />
              <RowDefinition
                Height="35" />
              <RowDefinition
                Height="35" />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
              <ColumnDefinition
                Width="120" />
              <ColumnDefinition
                Width="150" />
            </Grid.ColumnDefinitions>

            <Label
              Grid.Row="0"
              Grid.Column="0"
              Content="Hydraulics:"
              HorizontalAlignment="Right"
              VerticalAlignment="Center" />
            <ComboBox
              Grid.Row="0"
              Grid.Column="1"
              HorizontalAlignment="Stretch"
              VerticalAlignment="Center"
              Margin="5"
              ItemsSource="{Binding Hydraulics}"
              SelectedItem="{Binding SelectedHydraulics}"
              DisplayMemberPath="Name" />

            <Label
              Grid.Row="1"
              Grid.Column="0"
              Content="Index Points:"
              HorizontalAlignment="Right"
              VerticalAlignment="Center" />
            <ComboBox
              Grid.Row="1"
              Grid.Column="1"
              HorizontalAlignment="Stretch"
              VerticalAlignment="Center"
              Margin="5"
              ItemsSource="{Binding IndexPoints}"
              SelectedItem="{Binding SelectedIndexPoints}"
              DisplayMemberPath="Name" />

            <Label
              Grid.Row="2"
              Grid.Column="0"
              Content="LifeSim Simulation:"
              HorizontalAlignment="Right"
              VerticalAlignment="Center" />
            <ComboBox
              Grid.Row="2"
              Grid.Column="1"
              HorizontalAlignment="Stretch"
              VerticalAlignment="Center"
              Margin="5"
              ItemsSource="{Binding Simulations}"
              SelectedItem="{Binding SelectedSimulation}"
              DisplayMemberPath="Name" />
          </Grid>

          <!-- Right side: Alternatives and Hazard Times side by side -->
          <Grid
            Grid.Column="1"
            HorizontalAlignment="Stretch">
            <Grid.RowDefinitions>
              <RowDefinition
                Height="Auto" />
              <RowDefinition
                Height="*" />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
              <ColumnDefinition
                Width="Auto" />
              <ColumnDefinition
                Width="Auto" />
              <ColumnDefinition
                Width="Auto" />
              <ColumnDefinition
                Width="*" />
            </Grid.ColumnDefinitions>

            <TextBlock
              Text="LifeSim Alternatives:"
              Grid.Row="0"
              Grid.Column="0"
              HorizontalAlignment="Left"
              VerticalAlignment="Center"
              Margin="5" />
            <Button
              Grid.Row="0"
              Grid.Column="2"
              Content="Compute Curve"
              Command="{Binding ComputeCurvesCommand}"
              VerticalAlignment="Center"
              Margin="20,5,5,5"
              Padding="10,3" />
            <compute:ProgressControl
              Grid.Row="0"
              Grid.RowSpan="2"
              Grid.Column="3"
              Margin="20,5,5,5"
              DataContext="{Binding Job}"
              MinWidth="200"
              HorizontalAlignment="Stretch"/>
            <ItemsControl
              Margin="5"
              Grid.Row="1"
              Grid.Column="0"
              ItemsSource="{Binding LifeSimAlternatives}">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <CheckBox
                    Content="{Binding Name}"
                    IsChecked="{Binding IsChecked, Mode=TwoWay}"
                    Margin="4" />
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>

            <TextBlock
              Text="Hazard Times:"
              Grid.Row="0"
              Grid.Column="1"
              HorizontalAlignment="Left"
              VerticalAlignment="Center"
              Margin="20,5,5,5" />
            <StackPanel
              Margin="20,5,5,5"
              Grid.Row="1"
              Grid.Column="1">
              <ItemsControl
                ItemsSource="{Binding HazardTimes}">
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <Grid
                      Margin="4">
                      <Grid.ColumnDefinitions>
                        <ColumnDefinition
                          Width="Auto" />
                        <ColumnDefinition
                          Width="Auto" />
                        <ColumnDefinition
                          Width="40" />
                      </Grid.ColumnDefinitions>

                      <CheckBox
                        Grid.Column="0"
                        Content="{Binding Name}"
                        IsChecked="{Binding IsChecked, Mode=TwoWay}"
                        IsEnabled="{Binding IsEnabled}"
                        VerticalAlignment="Center"
                        Margin="0,0,8,0" />

                      <TextBlock
                        Grid.Column="1"
                        Text="Weight:"
                        VerticalAlignment="Center"
                        Margin="0,0,4,0" />

                      <TextBox
                        Grid.Column="2"
                        Text="{Binding Weight, Mode=TwoWay}"
                        IsEnabled="{Binding IsChecked}"
                        VerticalAlignment="Center" />
                    </Grid>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
            </StackPanel>
          </Grid>
        </Grid>
      </Grid>
    </GroupBox>

    <GridSplitter
      Grid.Row="1"
      HorizontalAlignment="Stretch" />

    <Grid
      Grid.Row="2">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="Auto" />
        <ColumnDefinition Width="*" />
      </Grid.ColumnDefinitions>

      <GroupBox
        Grid.Column="0"
        Header="Generated Curves"
        Margin="5">
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition
              Height="Auto" />
            <RowDefinition
              Height="*" />
          </Grid.RowDefinitions>
          <TextBlock
            Grid.Row="0"
            Text="Warning: Selected weights do not match computed curves. Please recompute."
            Foreground="OrangeRed"
            FontWeight="SemiBold"
            TextWrapping="Wrap"
            MaxWidth="350"
            Visibility="{Binding HasWeightMismatch, Converter={StaticResource BoolToVisibilityConverter}}"
            Margin="5" />
          <ListView
            Grid.Row="1"
            Margin="5"
            ItemsSource="{Binding LifeLossFunctions}"
            SelectedItem="{Binding SelectedFunction}"
            SelectionMode="Single">
            <ListView.Resources>
              <Style
                TargetType="GridViewColumnHeader">
                <Setter
                  Property="Padding"
                  Value="8,4" />
              </Style>
            </ListView.Resources>
            <ListView.View>
              <GridView>
                <GridViewColumn
                  Header="Function ID"
                  Width="auto"
                  DisplayMemberBinding="{Binding FunctionID}" />
                <GridViewColumn
                  Header="Simulation"
                  Width="auto"
                  DisplayMemberBinding="{Binding SimulationName}" />
                <GridViewColumn
                  Header="Impact Area"
                  Width="auto"
                  DisplayMemberBinding="{Binding SummaryZone}" />
                <GridViewColumn
                  Header="Hazard Time"
                  Width="auto"
                  DisplayMemberBinding="{Binding HazardTime, Converter={StaticResource MilTimeConverter}}" />
              </GridView>
            </ListView.View>
          </ListView>
        </Grid>
      </GroupBox>

      <oxy:PlotView
        Grid.Column="1"
        Margin="5"
        Model="{Binding MyModel, Mode=OneWay}" />
    </Grid>
  </Grid>
</UserControl>
